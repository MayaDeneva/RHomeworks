# ф.н. 2MI0700013
# Мая Денева
# Информационни системи 1 група



### Задача 1
# Входни данни
total_count <- 500
desired_ratio <- c(5, 2, 2, 1)
sample_count <- c(267, 91, 103, total_count - 267 - 91 - 103)

# Нормализиране на желаното съотношение
desired_ratio <- desired_ratio / sum(desired_ratio)

# Очаквани бройки ядки в съответствие с желаното съотношение
expected_count <- total_count * desired_ratio

# Хи-квадрат тест за адекватност
chi_sq <- chisq.test(sample_count, p = desired_ratio)

# Отпечатване на резултата от теста
print(chi_sq)


#Формулиране на хипотезите:

# Нулева хипотеза (H₀): Машината смесва ядките в желаното съотношение.
# Алтернативна хипотеза (H₁): Машината не смесва ядките в желаното съотношение.

# p-стойността e 0.2144 -по-малка от зададеното ниво на значимост, това означава, че имаме статистически 
#значими доказателства, че машината не смесва ядките в желаното съотношение. В такъв случай трябва
#да отхвърлим нулевата хипотеза.

library(ggplot2)

# Създаване на данните за разпределението
x <- seq(0, 1, 0.001)
y <- dchisq(x, df = 3)  

# Стойности на критичните квантили (примерни стойности)
critical_quantiles <- c(0.2, 0.5, 0.8)

# Създаване на данните за критичната област
critical_region <- data.frame(x = qchisq(critical_quantiles, df = 3))

# Създаване на графиката
plot <- ggplot(data.frame(x = x, y = y), aes(x = x, y = y)) +
  geom_line(color = "blue", size = 1) +  # Илюстрация на плътността на разпределението в синьо
  geom_vline(data = critical_region, aes(xintercept = x), color = "red", linetype = "dashed") +  # Илюстрация на критичната област в червено
  labs(x = "Стойност", y = "Плътност")  # Заглавия на осите

# Показване на графиката
print(plot)




###Задача 2.
#H₀: Процентът на дефектни елементи при
#използване на робот е равен на процента при сглобяване от човек (p1 = p2).
#H1₁: Процентът на дефектни елементи при използване на робот е по-малък от процента при 
#сглобяване от човек (p1 < p2).
# Входни данни
n_robot <- 500  # Общ брой сглобени елементи от робота
n_defective_robot <- 15  # Брой дефектни елементи от робота
p_human <- 0.035  # Процент дефектни елементи при сглобяване от човек

# Изчисляване на очакваните стойности
expected_defective_robot <- n_robot * p_human

# Изпълнение на теста на пропорции
test_result <- prop.test(n_defective_robot, n_robot, p = p_human, alternative = "less")

# Отпечатване на резултата от теста
print(test_result)

#p-стойността е 0.3132, която е по-голяма от нивото на значимост α = 0.03. 
#Това означава, че нямаме достатъчно статистически доказателства, за да заключим, че процентът на дефектни елементи при 
#използване на робот е по-малък от процента при сглобяване от човек.



###Задача 3.
# Входни данни
x <- c(30208.61, 30031.48, 31369.72, 30423.30, 28508.69, 30909.14, 29951.86,
       29651.07, 30092.92, 28934.14, 29548.45, 28838.97, 30333.31, 30535.98,
       31070.35, 31016.58, 28130.97, 29661.08, 30401.63, 31377.73, 29469.36,
       30411.83, 29530.51, 29803.23, 29491.12, 30340.85, 30239.38, 29328.12,
       30892.51, 31095.85, 30180.62, 28347.43, 30056.37, 30103.87, 29520.86,
       30201.51, 32292.90, 30325.08, 30318.04, 30460.16, 30902.91, 29832.22,
       31682.61, 30667.66, 31644.24, 30333.04, 29248.99, 29039.49)

y <- c(30138.48, 28128.17, 28457.52, 30869.64, 28350.69, 29833.84, 29906.35,
       27893.71, 30651.77, 29306.76, 29694.77, 28871.06, 29111.43, 29633.97,
       27248.59, 29677.19, 27304.51, 28393.82, 29049.14, 28471.64, 29624.78,
       30197.94, 29329.87, 28435.96, 29566.51, 28194.91, 29506.66, 28668.88,
       32377.36, 28764.72, 27153.31, 29129.34, 28193.12, 28103.39, 27355.46,
       29829.73, 30631.48, 29152.45, 30994.12, 30083.63, 29757.24, 28243.70,
       29023.39, 28290.52, 28230.68, 29105.40, 28693.04, 29281.10)

# Проверка за нормалност на разпределението
shapiro_test_x <- shapiro.test(x)
shapiro_test_y <- shapiro.test(y)

# Отпечатване на резултата от теста
print(shapiro_test_x)
print(shapiro_test_y)

##можем да приемем, че данните за изминатото разстояние до износване имат нормално разпределение.

# Двустранен t-тест
t_test <- t.test(x, y, alternative = "greater", var.equal = TRUE)

# Отпечатване на резултата
print(t_test)

# Получената p-стойност от теста е 5.079e-07, което е много по-малко от избраното ниво на значимост от α = 0.03. 
#имаме статистически значими доказателства да отхвърлим нулевата хипотеза и да заключим, 
#че средното изминато разстояние до износване е
#по-голямо при гумите от марка X в сравнение с гумите от марка Y.

#Нулева хипотеза (H0): Средното изминато разстояние до износване е еднакво за гумите от марка X и марка Y.
#Алтернативна хипотеза (H1): Средното изминато разстояние до износване е различно за гумите от марка X и
#марка Y.

#Тук използваме двустранен тест, тъй като искаме да проверим дали има значима разлика в средните
#стойности на изминатото разстояние между гумите от двете марки.

# Perform t-test
t_test <- t.test(x, y)

# Plot density graph of t-distribution
x_vals <- seq(-4, 4, length.out = 100)
y_vals <- dt(x_vals, df = length(x) + length(y) - 2)

plot(x_vals, y_vals, type = "l", xlim = c(-4, 4), ylim = c(0, 0.5), main = "Density Plot", xlab = "t-statistic", ylab = "Density")
lines(x_vals, y_vals, col = "blue")

# Define critical region (two-sided test)
critical_region <- c(qt(0.025, df = length(x) + length(y) - 2), qt(0.975, df = length(x) + length(y) - 2))

# Plot critical region in red
abline(v = critical_region, col = "red")




###Задача 4.

# Входни данни
Height <- c(189, 193, 190, 191, 192, 188, 187, 191, 194, 194, 193, 182, 183,
            191, 192, 193, 195, 196, 189, 186, 188, 189, 185, 190, 184, 179,
            180, 178, 177, 175, 181, 179, 186, 175, 170, 175, 169, 165, 169,
            170, 173, 175, 184, 180, 182, 184, 183, 181, 178, 174)
Weight <- c(89, 92, 90, 91, 93, 87, 90, 93, 96, 95, 94, 83, 84, 92, 92, 96, 94,
            97, 89, 84, 90, 92, 87, 92, 85, 85, 83, 84, 81, 78, 90, 81, 93, 84,
            78, 80, 74, 68, 72, 76, 78, 79, 88, 90, 94, 96, 95, 93, 82, 77)
Hips <- c(112, 112, 110, 111, 113, 107, 112, 115, 115, 117, 116, 102, 101, 113,
          114, 115, 117, 118, 112, 111, 113, 114, 109, 113, 101, 123, 125, 128,
          123, 118, 113, 108, 113, 108, 105, 102, 96, 88, 84, 99, 102, 105,
          134, 140, 146, 152, 150, 149, 104, 112)
ShouldersWidth <- c(40, 42, 39, 39, 40, 37, 40, 41, 42, 42, 41, 37, 38, 41, 42,
                    42, 43, 44, 40, 39, 40, 41, 40, 43, 37, 38, 39, 40, 42, 41,
                    39, 38, 40, 41, 38, 39, 40, 39, 43, 39, 42, 38, 39, 38, 41,
                    42, 39, 38, 43, 42)

# Създаване на данните като data frame
data <- data.frame(Height, Weight, Hips, ShouldersWidth)

## 1.зависимостта на талията от ръста, ширината на раменете и теглото

# Линейна регресия
lm_model <- lm(Hips ~ Height + Weight + ShouldersWidth, data = data)

# Извеждане на резултатите
summary(lm_model)

## 2.коефициентите в уравнението на регресия
coefficients <- coef(lm_model)
print(coefficients)


## 3.

#В модела има няколко фактора, които се считат за зависими, тъй като имат високи VIF 
#(Variance Inflation Factor) стойности:
  
#Height (Ръст) - с коефициент на регресия -2.1382391
#Weight (Тегло) - с коефициент на регресия 3.3699243
#ShouldersWidth (Широчина на раменете) - с коефициент на регресия -0.4725393
#Тези фактори имат влияние върху предсказването на талията (Hips).

## 4.
#За Height (Ръст):
  
#  Нулева хипотеза (H0): Коефициентът на регресия за Height е незначим (равен на 0).
#Алтернативна хипотеза (H1): Коефициентът на регресия за Height е значим (различен от 0).

#За Weight (Тегло):
  
#Нулева хипотеза (H0): Коефициентът на регресия за Weight е незначим (равен на 0).
#Алтернативна хипотеза (H1): Коефициентът на регресия за Weight е значим (различен от 0).

# За ShouldersWidth (Широчина на раменете):
  
#Нулева хипотеза (H0): Коефициентът на регресия за ShouldersWidth е незначим (равен на 0).
#Алтернативна хипотеза (H1): Коефициентът на регресия за ShouldersWidth е значим (различен от 0).


## 5.
summary(lm_model)
#Статистически значими са Height и Weight, тъй като имат по 3 звезди.


## 6. 
#Ще изключим ShouldersWidth от уравнението.
lm_new_model <- lm(Hips ~ Height + Weight, data = data)
summary(lm_new_model)


## 7.
#Taliya = 232.488 - 2.138 * Height + 3.370 * Weight


##8.

Taliya = 232.488 - 2.138 * Height + 3.370 * Weight

# Пресмятане на грешките
errors <- Taliya - predict(lm_model)

# Извеждане на първите 5 грешки
head(errors, 5)

# В този случай, грешките са нулеви, което означава,
#че няма отклонения между прогнозите и реалните стойности за тези наблюдения.


##9. a)
# Perform Shapiro-Wilk test
shapiro_test <- shapiro.test(errors)

# Print the test result
print(shapiro_test)

#p-стойността е по-голяма от нивото на значимост, 
# значи можем да подкрепим хипотезата, че разпределението на грешката е нормално.


## 9. b)
# Perform one-sample t-test
t_test <- t.test(errors, mu = 0)

# Print the test result
print(t_test)

#p-стойността е по-малка от избраното ниво на значимост, 
# значи може да се заключи, че средната стойност на грешката е значимо различна от 0.

## 9. c)
# Изчисляване на остатъците
residuals <- residuals(lm_model)

# Графика на остатъците спрямо значимите фактори
plot(residuals ~ Height, data = data)
plot(residuals ~ Weight, data = data)



## 10.
summary(lm_model)

# Извличане на стандартната грешка
se <- summary(lm_model)$sigma

#стандартната грешка на модела е 8.357


## 11.
# Коефициентът на детерминация е  0.6703


## 13.
#Taliya = 232.488 - 2.138 * Height + 3.370 * Weight
Hips173_85_40 = 232.488 - 2.138 * 173 + 3.370 * 85 - 0.472 * 40;

#130



